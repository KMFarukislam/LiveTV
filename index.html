<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LiveTV ‚Äì IPTV Channel Index</title>
<meta name="description" content="LiveTV IPTV channel index. Search and filter live TV channels.">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body{background:#0f1115;color:#eaeaf0;padding-top:360px}
header,#player,#toolbar{position:fixed;width:100%;left:0}
header{top:0;background:#141720;padding:10px;text-align:center;z-index:1000}
#player{top:52px;background:#000;z-index:999}
#toolbar{top:312px;background:#141720;padding:8px;z-index:998}
video{width:100%;max-height:260px;background:#000}
.logo{width:40px;height:40px;object-fit:contain;background:#000;border-radius:6px}
.status.active{color:#2ecc71}
.status.dead{color:#e74c3c}
.btn-q.active{background:#4da3ff;color:#000}
</style>
</head>

<body>

<header><h5 class="m-0">üì∫ LiveTV</h5></header>

<div id="player">
  <video id="video" controls></video>
</div>

<div id="toolbar" class="d-flex gap-2">
  <div id="qualities" class="d-flex gap-2"></div>
</div>

<div class="container mt-3">
  <div class="row g-2">
    <div class="col-md-4">
      <input id="search" class="form-control form-control-sm" placeholder="Search channel">
    </div>
    <div class="col-md-4">
      <select id="country" class="form-select form-select-sm"></select>
    </div>
    <div class="col-md-4">
      <select id="category" class="form-select form-select-sm"></select>
    </div>
  </div>
</div>

<div class="container mt-3">
<table class="table table-dark table-hover table-sm">
<thead>
<tr>
<th>Logo</th>
<th>Category</th>
<th>Channel</th>
<th>Status</th>
</tr>
</thead>
<tbody id="grid"></tbody>
</table>
</div>

<script>
const DATA="data/channels.min.json";
const PAGE=80;
let channels=[],view=[],page=0,hls;

const grid=document.getElementById("grid");
const video=document.getElementById("video");
const qualities=document.getElementById("qualities");
const search=document.getElementById("search");
const country=document.getElementById("country");
const category=document.getElementById("category");

const qOf=n=>{const m=n.match(/(\\d{3,4})p/i);return m?m[1]+"p":"Auto"};

fetch(DATA).then(r=>r.json()).then(d=>{
  channels=d.map(c=>({...c,active:!!c.u}));
  buildFilters();
  apply();
});

function buildFilters(){
  country.innerHTML='<option>All</option>'+[...new Set(channels.map(c=>c.c))].sort().map(c=>`<option>${c}</option>`).join("");
  category.innerHTML='<option>All</option>'+[...new Set(channels.flatMap(c=>(c.g||"").split(";")))].sort().map(c=>`<option>${c}</option>`).join("");
}

function apply(){
  page=0;grid.innerHTML="";
  const q=search.value.toLowerCase();
  view=channels.filter(c=>{
    if(!c.active) return false;
    if(q && !c.n.toLowerCase().includes(q)) return false;
    if(country.value!=="All" && c.c!==country.value) return false;
    if(category.value!=="All" && !(c.g||"").includes(category.value)) return false;
    return true;
  });
  render();
}

function render(){
  view.slice(page*PAGE,(page+1)*PAGE).forEach(c=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td><img class="logo" src="${c.l||''}"></td>
      <td>${(c.g||"").split(";")[0]||"-"}</td>
      <td>${c.n}</td>
      <td class="status active">‚óè Active</td>`;
    tr.onclick=()=>play(c.n);
    grid.appendChild(tr);
  });
  page++;
}

function play(n){
  const list=channels.filter(c=>c.n===n);
  qualities.innerHTML="";
  list.forEach((c,i)=>{
    const b=document.createElement("button");
    b.className="btn btn-sm btn-outline-light btn-q"+(i===0?" active":"");
    b.textContent=qOf(c.n);
    b.onclick=()=>switchQ(c.u,b);
    qualities.appendChild(b);
  });
  switchQ(list[0].u,qualities.firstChild);
}

function switchQ(u,b){
  document.querySelectorAll(".btn-q").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");
  if(hls){hls.destroy();hls=null}
  if(Hls.isSupported()){
    hls=new Hls();hls.loadSource(u);hls.attachMedia(video)
  }else video.src=u;
  video.play();
}

window.addEventListener("scroll",()=>{
  if(innerHeight+scrollY>=document.body.offsetHeight-300 && page*PAGE<view.length)render();
});
[search,country,category].forEach(e=>e.oninput=apply);
</script>

</body>
</html>
