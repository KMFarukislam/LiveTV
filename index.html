<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LiveTV ‚Äì IPTV</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Arial;
  background:#0f1115;
  color:#eaeaf0;
  overflow:hidden;
}

/* HEADER */
header{
  position:fixed;
  top:0;left:0;right:0;
  height:50px;
  background:#141720;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
#netStatus{
  position:absolute;
  right:10px;
  font-size:12px;
  color:#2ecc71;
}
#netStatus.offline{color:#e74c3c}

/* FOOTER */
footer{
  background:#141720;
  text-align:center;
  font-size:12px;
  color:#9aa0aa;
  padding:10px;
}
@media(min-width:768px){
  footer{
    position:fixed;
    bottom:0;left:0;right:0;
    height:40px;
    display:flex;
    align-items:center;
    justify-content:center;
  }
}

/* MAIN */
main{
  position:fixed;
  top:50px;
  bottom:0;
  left:0;
  right:0;
  display:grid;
  grid-template-columns:1fr;
}
@media(min-width:992px){
  main{
    bottom:40px;
    grid-template-columns:360px 1fr;
  }
}

/* PLAYER */
.player-box{
  position:relative;
  width:100%;
  background:#000;
  overflow:hidden;
}
video{
  display:block;
  width:100%;
  height:auto;
  margin:0 auto;
  background:#000;
  object-fit:cover;
  object-position:center;
}

/* PLAYER OVERLAY */
#playerOverlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.35);
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:5;
  pointer-events:none;
}
.spinner{
  width:42px;height:42px;
  border:4px solid rgba(255,255,255,.3);
  border-top:4px solid #4da3ff;
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
#retryText{margin-top:8px;font-size:13px}

/* TOOLBAR */
.toolbar{
  background:#181b22;
  display:flex;
  gap:6px;
  padding:8px;
  flex-wrap:wrap;
}
.toolbar button{
  background:#222735;
  border:1px solid #252a34;
  color:#eaeaf0;
  padding:6px 10px;
  border-radius:8px;
  cursor:pointer;
}
.toolbar button.active{background:#4da3ff;color:#000}

/* RIGHT PANEL */
.right-panel{
  display:flex;
  flex-direction:column;
  height:100%;
  min-height:0;
}

/* FILTERS */
.filters{
  display:grid;
  grid-template-columns:1fr .8fr .8fr;
  gap:6px;
  padding:8px;
  background:#181b22;
}
.filters input,.filters select{
  background:#0f1115;
  border:1px solid #252a34;
  color:#eaeaf0;
  padding:6px 8px;
  border-radius:8px;
}

/* CHIPS */
.chips{
  display:flex;
  gap:6px;
  padding:6px 8px;
  background:#181b22;
  flex-wrap:wrap;
}
.chips span{
  padding:4px 10px;
  border-radius:14px;
  background:#222735;
  font-size:12px;
  cursor:pointer;
}
.chips span.active{background:#4da3ff;color:#000}

/* TABLE */
.table-wrap{
  flex:1;
  overflow-y:auto;
  min-height:0;
  -webkit-overflow-scrolling:touch;
  overscroll-behavior:contain;
}
table{width:100%;border-collapse:collapse}
thead{
  position:sticky;
  top:0;
  background:#141720;
  z-index:10;
}
th,td{
  padding:8px;
  border-bottom:1px solid #252a34;
  font-size:14px;
}
tr{height:52px}
tr:hover{background:#222735;cursor:pointer}
tr.playing{background:#1f3b5c}

/* CHANNEL */
.logo{
  width:36px;height:36px;
  object-fit:contain;
  background:#000;
  border-radius:6px;
}
.star{color:#f1c40f}
.dot{
  width:10px;height:10px;
  border-radius:50%;
  display:inline-block;
}
.green{background:#2ecc71}
.red{background:#e74c3c}
</style>
</head>

<body>

<header>
  üì∫ LiveTV
  <span id="netStatus">‚óè Online</span>
</header>

<main>

<!-- LEFT -->
<section>
  <div class="player-box">
    <video id="video" controls playsinline></video>
    <div id="playerOverlay">
      <div class="spinner"></div>
      <div id="retryText">Reconnecting‚Ä¶</div>
    </div>
  </div>

  <div class="toolbar">
    <button id="favBtn">‚≠ê Favourite</button>
    <button id="reloadBtn">üîÑ Reload</button>
    <button id="favOnlyBtn">‚≠ê Only</button>
    <div id="qualities" style="display:flex;gap:6px"></div>
  </div>
</section>

<!-- RIGHT -->
<section class="right-panel">

  <div class="filters">
    <input id="search" placeholder="üîç Search">
    <select id="country"></select>
    <select id="category"></select>
  </div>

  <div class="chips" id="chips">
    <span data-cat="All" class="active">All</span>
    <span data-cat="Sports">Sports</span>
    <span data-cat="News">News</span>
    <span data-cat="Movies">Movies</span>
    <span data-cat="Kids">Kids</span>
    <span data-cat="Music">Music</span>
  </div>

  <div class="table-wrap" id="scrollBox">
    <table>
      <thead>
        <tr>
          <th></th>
          <th>Logo</th>
          <th>Category</th>
          <th>Channel</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="grid"></tbody>
    </table>
  </div>

</section>
</main>

<footer>No streams are hosted ‚Ä¢ iptv-org</footer>

<script>
const DATA="data/channels.min.json";
const ROW=52,VISIBLE=15,MAX_RETRY=3;
let channels=[],view=[],start=0,current=null,currentUrl=null,hls;
let retryCount=0,qualityList=[],qIndex=0;
const favs=new Set(JSON.parse(localStorage.getItem("favs")||"[]"));

const video=document.getElementById("video");
const grid=document.getElementById("grid");
const scrollBox=document.getElementById("scrollBox");
const qualities=document.getElementById("qualities");
const overlay=document.getElementById("playerOverlay");
const retryText=document.getElementById("retryText");

const search=document.getElementById("search");
const country=document.getElementById("country");
const category=document.getElementById("category");
const favBtn=document.getElementById("favBtn");
const favOnlyBtn=document.getElementById("favOnlyBtn");
const reloadBtn=document.getElementById("reloadBtn");

let favOnly=false;

/* UTIL */
const norm=s=>s.toLowerCase().replace(/[^a-z0-9]/g,"");
const qOf=n=>(n.match(/(\d{3,4})p/i)||[])[1]||"Auto";

/* NETWORK */
const net=document.getElementById("netStatus");
function netUpdate(){
  if(navigator.onLine){
    net.textContent="‚óè Online";
    net.classList.remove("offline");
  }else{
    net.textContent="‚óè Offline";
    net.classList.add("offline");
    showRetry();
  }
}
window.addEventListener("online",netUpdate);
window.addEventListener("offline",netUpdate);
netUpdate();

/* PLAYER SIZE */
function resizePlayer(){
  let h=Math.round(window.innerWidth*9/16);
  h=Math.max(180,Math.min(420,h));
  video.style.height=h+"px";
}
window.addEventListener("resize",resizePlayer);
resizePlayer();

/* OVERLAY */
function showRetry(){
  overlay.style.display="flex";
  retryText.textContent=`Reconnecting‚Ä¶ (${retryCount}/${MAX_RETRY})`;
}
function hideRetry(){overlay.style.display="none"}

/* LOAD DATA */
fetch(DATA).then(r=>r.json()).then(d=>{
  channels=d.map(c=>({...c,active:!!c.u,country:c.c||"International"}));
  buildFilters();
  apply();
});

/* FILTERS */
function buildFilters(){
  country.innerHTML='<option>All</option>'+[...new Set(channels.map(c=>c.country))].sort().map(c=>`<option>${c}</option>`).join("");
  category.innerHTML='<option>All</option>'+[...new Set(channels.flatMap(c=>(c.g||"").split(";")))].sort().map(c=>`<option>${c}</option>`).join("");
}

function apply(){
  start=0;
  const q=norm(search.value);
  view=channels.filter(c=>{
    if(!c.active) return false;
    if(favOnly && !favs.has(c.n)) return false;
    if(q && !norm(c.n).includes(q)) return false;
    if(country.value!=="All" && c.country!==country.value) return false;
    if(category.value!=="All" && !(c.g||"").includes(category.value)) return false;
    return true;
  });
  render();
}

/* RENDER */
function render(){
  const end=Math.min(start+VISIBLE,view.length);
  grid.innerHTML="";
  grid.style.paddingTop=(start*ROW)+"px";
  grid.style.paddingBottom=((view.length-end)*ROW)+"px";

  view.slice(start,end).forEach(c=>{
    const tr=document.createElement("tr");
    if(c.n===current) tr.classList.add("playing");
    tr.innerHTML=`
      <td>${favs.has(c.n)?"<span class='star'>‚òÖ</span>":""}</td>
      <td><img class="logo" src="${c.l||''}"></td>
      <td>${(c.g||"").split(";")[0]||"-"}</td>
      <td>${c.n}</td>
      <td><span class="dot ${c.active?'green':'red'}"></span></td>`;
    tr.onclick=()=>play(c.n);
    grid.appendChild(tr);
  });
}

/* SCROLL */
scrollBox.addEventListener("scroll",()=>{
  const i=Math.floor(scrollBox.scrollTop/ROW);
  if(i!==start){start=i;render();}
});

/* PLAY */
function play(name){
  current=name;
  retryCount=0;
  qualityList=channels.filter(c=>c.n===name);
  qIndex=0;
  qualities.innerHTML="";
  qualityList.forEach((c,i)=>{
    const b=document.createElement("button");
    b.textContent=qOf(c.n);
    if(i===0)b.classList.add("active");
    b.onclick=()=>{qIndex=i;retryCount=0;switchQuality(c.u,b)};
    qualities.appendChild(b);
  });
  switchQuality(qualityList[0].u,qualities.firstChild);
  render();
}

function switchQuality(url,btn){
  currentUrl=url;
  [...qualities.children].forEach(b=>b.classList.remove("active"));
  if(btn)btn.classList.add("active");

  if(hls){hls.destroy();hls=null}

  if(Hls.isSupported()){
    hls=new Hls();
    hls.on(Hls.Events.ERROR,(e,d)=>{
      if(!d.fatal) return;
      if(retryCount<MAX_RETRY){
        retryCount++;
        showRetry();
        setTimeout(()=>switchQuality(currentUrl,qualities.children[qIndex]),2000);
        return;
      }
      if(qIndex+1<qualityList.length){
        qIndex++;retryCount=0;
        switchQuality(qualityList[qIndex].u,qualities.children[qIndex]);
      }
    });
    hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play().catch(()=>{}));
    hls.loadSource(url);
    hls.attachMedia(video);
  }else{
    video.src=url;
  }
  video.play().catch(()=>{});
}

video.addEventListener("playing",()=>{retryCount=0;hideRetry()});
video.addEventListener("canplay",hideRetry);

/* BUTTONS */
reloadBtn.onclick=()=>currentUrl&&switchQuality(currentUrl,qualities.children[qIndex]);
favBtn.onclick=()=>{
  if(!current)return;
  favs.has(current)?favs.delete(current):favs.add(current);
  localStorage.setItem("favs",JSON.stringify([...favs]));
  render();
};
favOnlyBtn.onclick=()=>{
  favOnly=!favOnly;
  favOnlyBtn.classList.toggle("active");
  apply();
};

document.getElementById("chips").onclick=e=>{
  if(e.target.dataset.cat){
    document.querySelectorAll(".chips span").forEach(x=>x.classList.remove("active"));
    e.target.classList.add("active");
    category.value=e.target.dataset.cat==="All"?"All":e.target.dataset.cat;
    apply();
  }
};

[search,country,category].forEach(e=>e.oninput=apply);
</script>

</body>
</html>
